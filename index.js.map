{"version":3,"file":"index.js","sources":["quilk-frontend-router.js"],"sourcesContent":["class QuilkFrontendRouter {\r\n\r\n  /**\r\n   * Loops over a routesObject provided calling any classes that match the current browser url\r\n   */\r\n  constructor (routesObject) {\r\n    let path = this.trimEnd(String(window.location.pathname), '/')\r\n    for (let key in routesObject) {\r\n\r\n      if (Array.isArray(routesObject[key])) {\r\n        this.run_path_matchers(routesObject, path, key)\r\n      } else {\r\n        if (key === 'path') {\r\n          for (let subkey in routesObject[key]) {\r\n            this.run_path_matchers(routesObject[key], path, subkey)\r\n          }\r\n        } else {\r\n          // check we have jquery else alert an error\r\n          if (typeof window.$ === 'undefined') {\r\n            alert('To use attribute selection with the QuilkFrontendRouter please ensure you load in jquery to the window object.')\r\n          } else {\r\n            this.run_attribute_matchers(routesObject[key])\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialises classes based on the attributes given\r\n   *\r\n   * @param attributesObject\r\n   */\r\n  run_attribute_matchers (attributesObject) {\r\n    let $ = window.$\r\n    attributesObject.forEach((values, attr) => {\r\n      values.forEach((constructors, value) => {\r\n        if (value === '*') {\r\n          this.run_attribute_constructors(constructors)\r\n        } else {\r\n          let valueArr = value.split(' ')\r\n\r\n          // run against classes\r\n          switch (attr) {\r\n            case 'class' : {\r\n              let selector = valueArr.join(', .')\r\n              if ($(selector).length > 0) this.run_attribute_constructors(constructors)\r\n            }\r\n              break\r\n            case 'id' : {\r\n              let selector = valueArr.join(', #')\r\n              if ($(selector).length > 0) this.run_attribute_constructors(constructors)\r\n            }\r\n              break;\r\n            default : {\r\n              let selector = ''\r\n              valueArr.forEach((attrVal)=>{\r\n                selector += '*['+attr+'='+attrVal+'], '\r\n              })\r\n              selector = selector.slice(0, -2);\r\n\r\n              if ($(selector).length > 0) {\r\n                this.run_attribute_constructors(constructors)\r\n              }\r\n            }\r\n          }\r\n        }\r\n      })\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Pass an numeric array of class to initialize\r\n   *\r\n   * @param constructorsArr\r\n   */\r\n  run_attribute_constructors (constructorsArr) {\r\n    constructorsArr.forEach((construct, i) => {\r\n      this.start_instance(construct)\r\n    })\r\n  }\r\n\r\n  /**\r\n   * Runs checks against the key and the path\r\n   *\r\n   * @param routesObject\r\n   * @param path\r\n   * @param key\r\n   */\r\n  run_path_matchers (routesObject, path, key) {\r\n    if (this.path_match(path, key)) {\r\n      for (let i = 0; i < routesObject[key].length; ++i) {\r\n        this.start_instance(routesObject[key][i])\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Calls new on a class\r\n   *\r\n   * @param init\r\n   */\r\n  start_instance (init) {\r\n    try {\r\n      new init\r\n    } catch (e) {\r\n      console.error(e)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns true if the provided path matches the key\r\n   *\r\n   * @param path\r\n   * @param key\r\n   * @returns {boolean}\r\n   */\r\n  path_match (path, key) {\r\n\r\n    //handle trailing wildcards\r\n    if (key.slice(-1) === '*') {\r\n\r\n      key = key.substring(0, key.length - 1)\r\n\r\n      if (key === '/' && path !== '/' && path.split('/').length === 2) return true\r\n\r\n      if (this.compare(path, key)) return true\r\n      else return ( path.indexOf(key) === 0 )\r\n    }\r\n\r\n    //handle std route\r\n    if (key.indexOf('(') === -1) return this.compare(path, key)\r\n\r\n    //handle key with params eg ()\r\n    let match = false\r\n    this.key_to_paths(key).forEach((k_path) => {\r\n      if (this.compare(path, k_path)) match = true\r\n    })\r\n\r\n    return match\r\n  }\r\n\r\n  /**\r\n   * Takes a key from the constants and returns a numeric array of all possible paths\r\n   *\r\n   * @param key\r\n   * @returns {[*]}\r\n   */\r\n  key_to_paths (key) {\r\n    let key_parts = key.split('(')\r\n    let ret = [this.trimEnd(key_parts[0], '/')]\r\n    //walk over each provided segment in the () | separated params, ensuring the last ) char is stripped\r\n    key_parts[1].slice(0, -1).split('|').forEach((seg) => {\r\n      ret.push(this.trimEnd(key_parts[0] + seg, '/'))\r\n    })\r\n    return ret\r\n  }\r\n\r\n  /**\r\n   * Compares a given key and path. If the kay contains a : separated param this is removed first from the key and path before comparison.\r\n   *\r\n   * @param path\r\n   * @param key\r\n   */\r\n  compare (path, key) {\r\n\r\n    key = this.trimEnd(key, '/')\r\n    if (key.indexOf(':') === -1) return (path === key)\r\n\r\n    //we have found a key with a param, strip param from path and key, then re-compared\r\n    key = this.trimEnd(key.split(':')[0], '/')\r\n\r\n    //strip the trialing url segment\r\n    let paths = path.split('/')\r\n    paths.pop()\r\n\r\n    path = this.trimEnd(paths.join('/'), '/')\r\n\r\n    return (path === key)\r\n  }\r\n\r\n  /**\r\n   * Trims the end of the string if matched to the str2trim. Clone of the lodash trimEnd function\r\n   *\r\n   * @param str\r\n   * @param str2Trim\r\n   * @returns {string}\r\n   */\r\n  trimEnd (str, str2Trim) {\r\n    if (str.substring(str.length - str2Trim.length, str.length) === str2Trim)\r\n      return str.substring(0, str.length - str2Trim.length)\r\n    return str\r\n  }\r\n}\r\n\r\nexport default QuilkFrontendRouter"],"names":["let","this","selector"],"mappings":"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","preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjpudWxsLCJzb3VyY2VzIjpbIi9tZWRpYS9qb2huL0RhdGEvY29kZV9wcml2YXRlL3F1aWxrX3JvdXRlci9saWIvcXVpbGstZnJvbnRlbmQtcm91dGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNsYXNzIFF1aWxrRnJvbnRlbmRSb3V0ZXIge1xyXG5cclxuICAvKipcclxuICAgKiBMb29wcyBvdmVyIGEgcm91dGVzT2JqZWN0IHByb3ZpZGVkIGNhbGxpbmcgYW55IGNsYXNzZXMgdGhhdCBtYXRjaCB0aGUgY3VycmVudCBicm93c2VyIHVybFxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yIChyb3V0ZXNPYmplY3QpIHtcclxuICAgIGxldCBwYXRoID0gdGhpcy50cmltRW5kKFN0cmluZyh3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUpLCAnLycpXHJcbiAgICBmb3IgKGxldCBrZXkgaW4gcm91dGVzT2JqZWN0KSB7XHJcblxyXG4gICAgICBpZiAoQXJyYXkuaXNBcnJheShyb3V0ZXNPYmplY3Rba2V5XSkpIHtcclxuICAgICAgICB0aGlzLnJ1bl9wYXRoX21hdGNoZXJzKHJvdXRlc09iamVjdCwgcGF0aCwga2V5KVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGlmIChrZXkgPT09ICdwYXRoJykge1xyXG4gICAgICAgICAgZm9yIChsZXQgc3Via2V5IGluIHJvdXRlc09iamVjdFtrZXldKSB7XHJcbiAgICAgICAgICAgIHRoaXMucnVuX3BhdGhfbWF0Y2hlcnMocm91dGVzT2JqZWN0W2tleV0sIHBhdGgsIHN1YmtleSlcclxuICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgLy8gY2hlY2sgd2UgaGF2ZSBqcXVlcnkgZWxzZSBhbGVydCBhbiBlcnJvclxyXG4gICAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cuJCA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICAgICAgYWxlcnQoJ1RvIHVzZSBhdHRyaWJ1dGUgc2VsZWN0aW9uIHdpdGggdGhlIFF1aWxrRnJvbnRlbmRSb3V0ZXIgcGxlYXNlIGVuc3VyZSB5b3UgbG9hZCBpbiBqcXVlcnkgdG8gdGhlIHdpbmRvdyBvYmplY3QuJylcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMucnVuX2F0dHJpYnV0ZV9tYXRjaGVycyhyb3V0ZXNPYmplY3Rba2V5XSlcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEluaXRpYWxpc2VzIGNsYXNzZXMgYmFzZWQgb24gdGhlIGF0dHJpYnV0ZXMgZ2l2ZW5cclxuICAgKlxyXG4gICAqIEBwYXJhbSBhdHRyaWJ1dGVzT2JqZWN0XHJcbiAgICovXHJcbiAgcnVuX2F0dHJpYnV0ZV9tYXRjaGVycyAoYXR0cmlidXRlc09iamVjdCkge1xyXG4gICAgbGV0ICQgPSB3aW5kb3cuJFxyXG4gICAgYXR0cmlidXRlc09iamVjdC5mb3JFYWNoKCh2YWx1ZXMsIGF0dHIpID0+IHtcclxuICAgICAgdmFsdWVzLmZvckVhY2goKGNvbnN0cnVjdG9ycywgdmFsdWUpID0+IHtcclxuICAgICAgICBpZiAodmFsdWUgPT09ICcqJykge1xyXG4gICAgICAgICAgdGhpcy5ydW5fYXR0cmlidXRlX2NvbnN0cnVjdG9ycyhjb25zdHJ1Y3RvcnMpXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGxldCB2YWx1ZUFyciA9IHZhbHVlLnNwbGl0KCcgJylcclxuXHJcbiAgICAgICAgICAvLyBydW4gYWdhaW5zdCBjbGFzc2VzXHJcbiAgICAgICAgICBzd2l0Y2ggKGF0dHIpIHtcclxuICAgICAgICAgICAgY2FzZSAnY2xhc3MnIDoge1xyXG4gICAgICAgICAgICAgIGxldCBzZWxlY3RvciA9IHZhbHVlQXJyLmpvaW4oJywgLicpXHJcbiAgICAgICAgICAgICAgaWYgKCQoc2VsZWN0b3IpLmxlbmd0aCA+IDApIHRoaXMucnVuX2F0dHJpYnV0ZV9jb25zdHJ1Y3RvcnMoY29uc3RydWN0b3JzKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgYnJlYWtcclxuICAgICAgICAgICAgY2FzZSAnaWQnIDoge1xyXG4gICAgICAgICAgICAgIGxldCBzZWxlY3RvciA9IHZhbHVlQXJyLmpvaW4oJywgIycpXHJcbiAgICAgICAgICAgICAgaWYgKCQoc2VsZWN0b3IpLmxlbmd0aCA+IDApIHRoaXMucnVuX2F0dHJpYnV0ZV9jb25zdHJ1Y3RvcnMoY29uc3RydWN0b3JzKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGRlZmF1bHQgOiB7XHJcbiAgICAgICAgICAgICAgbGV0IHNlbGVjdG9yID0gJydcclxuICAgICAgICAgICAgICB2YWx1ZUFyci5mb3JFYWNoKChhdHRyVmFsKT0+e1xyXG4gICAgICAgICAgICAgICAgc2VsZWN0b3IgKz0gJypbJythdHRyKyc9JythdHRyVmFsKyddLCAnXHJcbiAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICBzZWxlY3RvciA9IHNlbGVjdG9yLnNsaWNlKDAsIC0yKTtcclxuXHJcbiAgICAgICAgICAgICAgaWYgKCQoc2VsZWN0b3IpLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucnVuX2F0dHJpYnV0ZV9jb25zdHJ1Y3RvcnMoY29uc3RydWN0b3JzKVxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBQYXNzIGFuIG51bWVyaWMgYXJyYXkgb2YgY2xhc3MgdG8gaW5pdGlhbGl6ZVxyXG4gICAqXHJcbiAgICogQHBhcmFtIGNvbnN0cnVjdG9yc0FyclxyXG4gICAqL1xyXG4gIHJ1bl9hdHRyaWJ1dGVfY29uc3RydWN0b3JzIChjb25zdHJ1Y3RvcnNBcnIpIHtcclxuICAgIGNvbnN0cnVjdG9yc0Fyci5mb3JFYWNoKChjb25zdHJ1Y3QsIGkpID0+IHtcclxuICAgICAgdGhpcy5zdGFydF9pbnN0YW5jZShjb25zdHJ1Y3QpXHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUnVucyBjaGVja3MgYWdhaW5zdCB0aGUga2V5IGFuZCB0aGUgcGF0aFxyXG4gICAqXHJcbiAgICogQHBhcmFtIHJvdXRlc09iamVjdFxyXG4gICAqIEBwYXJhbSBwYXRoXHJcbiAgICogQHBhcmFtIGtleVxyXG4gICAqL1xyXG4gIHJ1bl9wYXRoX21hdGNoZXJzIChyb3V0ZXNPYmplY3QsIHBhdGgsIGtleSkge1xyXG4gICAgaWYgKHRoaXMucGF0aF9tYXRjaChwYXRoLCBrZXkpKSB7XHJcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcm91dGVzT2JqZWN0W2tleV0ubGVuZ3RoOyArK2kpIHtcclxuICAgICAgICB0aGlzLnN0YXJ0X2luc3RhbmNlKHJvdXRlc09iamVjdFtrZXldW2ldKVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDYWxscyBuZXcgb24gYSBjbGFzc1xyXG4gICAqXHJcbiAgICogQHBhcmFtIGluaXRcclxuICAgKi9cclxuICBzdGFydF9pbnN0YW5jZSAoaW5pdCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgbmV3IGluaXRcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihlKVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmV0dXJucyB0cnVlIGlmIHRoZSBwcm92aWRlZCBwYXRoIG1hdGNoZXMgdGhlIGtleVxyXG4gICAqXHJcbiAgICogQHBhcmFtIHBhdGhcclxuICAgKiBAcGFyYW0ga2V5XHJcbiAgICogQHJldHVybnMge2Jvb2xlYW59XHJcbiAgICovXHJcbiAgcGF0aF9tYXRjaCAocGF0aCwga2V5KSB7XHJcblxyXG4gICAgLy9oYW5kbGUgdHJhaWxpbmcgd2lsZGNhcmRzXHJcbiAgICBpZiAoa2V5LnNsaWNlKC0xKSA9PT0gJyonKSB7XHJcblxyXG4gICAgICBrZXkgPSBrZXkuc3Vic3RyaW5nKDAsIGtleS5sZW5ndGggLSAxKVxyXG5cclxuICAgICAgaWYgKGtleSA9PT0gJy8nICYmIHBhdGggIT09ICcvJyAmJiBwYXRoLnNwbGl0KCcvJykubGVuZ3RoID09PSAyKSByZXR1cm4gdHJ1ZVxyXG5cclxuICAgICAgaWYgKHRoaXMuY29tcGFyZShwYXRoLCBrZXkpKSByZXR1cm4gdHJ1ZVxyXG4gICAgICBlbHNlIHJldHVybiAoIHBhdGguaW5kZXhPZihrZXkpID09PSAwIClcclxuICAgIH1cclxuXHJcbiAgICAvL2hhbmRsZSBzdGQgcm91dGVcclxuICAgIGlmIChrZXkuaW5kZXhPZignKCcpID09PSAtMSkgcmV0dXJuIHRoaXMuY29tcGFyZShwYXRoLCBrZXkpXHJcblxyXG4gICAgLy9oYW5kbGUga2V5IHdpdGggcGFyYW1zIGVnICgpXHJcbiAgICBsZXQgbWF0Y2ggPSBmYWxzZVxyXG4gICAgdGhpcy5rZXlfdG9fcGF0aHMoa2V5KS5mb3JFYWNoKChrX3BhdGgpID0+IHtcclxuICAgICAgaWYgKHRoaXMuY29tcGFyZShwYXRoLCBrX3BhdGgpKSBtYXRjaCA9IHRydWVcclxuICAgIH0pXHJcblxyXG4gICAgcmV0dXJuIG1hdGNoXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBUYWtlcyBhIGtleSBmcm9tIHRoZSBjb25zdGFudHMgYW5kIHJldHVybnMgYSBudW1lcmljIGFycmF5IG9mIGFsbCBwb3NzaWJsZSBwYXRoc1xyXG4gICAqXHJcbiAgICogQHBhcmFtIGtleVxyXG4gICAqIEByZXR1cm5zIHtbKl19XHJcbiAgICovXHJcbiAga2V5X3RvX3BhdGhzIChrZXkpIHtcclxuICAgIGxldCBrZXlfcGFydHMgPSBrZXkuc3BsaXQoJygnKVxyXG4gICAgbGV0IHJldCA9IFt0aGlzLnRyaW1FbmQoa2V5X3BhcnRzWzBdLCAnLycpXVxyXG4gICAgLy93YWxrIG92ZXIgZWFjaCBwcm92aWRlZCBzZWdtZW50IGluIHRoZSAoKSB8IHNlcGFyYXRlZCBwYXJhbXMsIGVuc3VyaW5nIHRoZSBsYXN0ICkgY2hhciBpcyBzdHJpcHBlZFxyXG4gICAga2V5X3BhcnRzWzFdLnNsaWNlKDAsIC0xKS5zcGxpdCgnfCcpLmZvckVhY2goKHNlZykgPT4ge1xyXG4gICAgICByZXQucHVzaCh0aGlzLnRyaW1FbmQoa2V5X3BhcnRzWzBdICsgc2VnLCAnLycpKVxyXG4gICAgfSlcclxuICAgIHJldHVybiByZXRcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENvbXBhcmVzIGEgZ2l2ZW4ga2V5IGFuZCBwYXRoLiBJZiB0aGUga2F5IGNvbnRhaW5zIGEgOiBzZXBhcmF0ZWQgcGFyYW0gdGhpcyBpcyByZW1vdmVkIGZpcnN0IGZyb20gdGhlIGtleSBhbmQgcGF0aCBiZWZvcmUgY29tcGFyaXNvbi5cclxuICAgKlxyXG4gICAqIEBwYXJhbSBwYXRoXHJcbiAgICogQHBhcmFtIGtleVxyXG4gICAqL1xyXG4gIGNvbXBhcmUgKHBhdGgsIGtleSkge1xyXG5cclxuICAgIGtleSA9IHRoaXMudHJpbUVuZChrZXksICcvJylcclxuICAgIGlmIChrZXkuaW5kZXhPZignOicpID09PSAtMSkgcmV0dXJuIChwYXRoID09PSBrZXkpXHJcblxyXG4gICAgLy93ZSBoYXZlIGZvdW5kIGEga2V5IHdpdGggYSBwYXJhbSwgc3RyaXAgcGFyYW0gZnJvbSBwYXRoIGFuZCBrZXksIHRoZW4gcmUtY29tcGFyZWRcclxuICAgIGtleSA9IHRoaXMudHJpbUVuZChrZXkuc3BsaXQoJzonKVswXSwgJy8nKVxyXG5cclxuICAgIC8vc3RyaXAgdGhlIHRyaWFsaW5nIHVybCBzZWdtZW50XHJcbiAgICBsZXQgcGF0aHMgPSBwYXRoLnNwbGl0KCcvJylcclxuICAgIHBhdGhzLnBvcCgpXHJcblxyXG4gICAgcGF0aCA9IHRoaXMudHJpbUVuZChwYXRocy5qb2luKCcvJyksICcvJylcclxuXHJcbiAgICByZXR1cm4gKHBhdGggPT09IGtleSlcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFRyaW1zIHRoZSBlbmQgb2YgdGhlIHN0cmluZyBpZiBtYXRjaGVkIHRvIHRoZSBzdHIydHJpbS4gQ2xvbmUgb2YgdGhlIGxvZGFzaCB0cmltRW5kIGZ1bmN0aW9uXHJcbiAgICpcclxuICAgKiBAcGFyYW0gc3RyXHJcbiAgICogQHBhcmFtIHN0cjJUcmltXHJcbiAgICogQHJldHVybnMge3N0cmluZ31cclxuICAgKi9cclxuICB0cmltRW5kIChzdHIsIHN0cjJUcmltKSB7XHJcbiAgICBpZiAoc3RyLnN1YnN0cmluZyhzdHIubGVuZ3RoIC0gc3RyMlRyaW0ubGVuZ3RoLCBzdHIubGVuZ3RoKSA9PT0gc3RyMlRyaW0pXHJcbiAgICAgIHJldHVybiBzdHIuc3Vic3RyaW5nKDAsIHN0ci5sZW5ndGggLSBzdHIyVHJpbS5sZW5ndGgpXHJcbiAgICByZXR1cm4gc3RyXHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBRdWlsa0Zyb250ZW5kUm91dGVyIl0sIm5hbWVzIjpbImxldCIsInRoaXMiLCJzZWxlY3RvciJdLCJtYXBwaW5ncyI6IkFBQUEsSUFBTSxtQkFBbUIsR0FBQyw0QkFLYixFQUFFLFlBQVksRUFBRTs7O0VBQzNCLElBQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLEVBQUUsR0FBRyxFQUFDO0VBQ2hFLEtBQU9BLElBQUksR0FBRyxJQUFJLFlBQVksRUFBRTs7SUFFOUIsSUFBTSxLQUFLLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFO01BQ3RDLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxZQUFZLEVBQUUsSUFBSSxFQUFFLEdBQUcsRUFBQztLQUNoRCxNQUFNO01BQ1AsSUFBTSxHQUFHLEtBQUssTUFBTSxFQUFFO1FBQ3BCLEtBQU9BLElBQUksTUFBTSxJQUFJLFlBQVksQ0FBQyxHQUFHLENBQUMsRUFB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"}